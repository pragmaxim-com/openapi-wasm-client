## Rest-api with autogenerated wasm client library

Atix-web rest-api with [progenitor](https://github.com/oxidecomputer/progenitor) and [https://github.com/rustwasm/wasm-pack](wasm-pack) generated client library from
OpenAPI specification.

### Building OpenAPI

First we build our `openapi.json` specification which will later be served at http://127.0.0.1:8082/swagger :

```
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash
nvm install 20
npm install --global yarn
npm install --global @redocly/cli@latest

yarn bundle
```

### Generating javascript client 

Then we generate javascript library using a `wasm-client` module from [example-wasm](https://github.com/oxidecomputer/progenitor/tree/main/example-wasm) :

```
# install web-pack
curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh

cd wasm-client
wasm-pack build --target web
```

### Running Actix-web http server

```
cargo run
```

```
curl -X POST http://127.0.0.1:8082/blocks -H "Content-Type: application/json" -d '{"block_id":"frog", "height":1}'
curl -X POST http://127.0.0.1:8082/addresses -H "Content-Type: application/json" -d '{"address":"croco", "balance":2}'
```

```
curl http://127.0.0.1:8082/blocks
curl http://127.0.0.1:8082/addresses
```

Now you can access swagger at http://127.0.0.1:8082/swagger and demo at http://localhost:8082/wasm.